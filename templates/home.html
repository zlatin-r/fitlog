{% extends 'base.html' %}
{% load static %}

{% block content %}
    <a href="{% url 'login-page' %}">Login</a>
    <h1>This is the home page</h1>
    <h1 id="auth-status">Is user authenticated: Loading...</h1>
    <h1 id="username">Username: Loading...</h1>

    <script>
        // Fetch user details using the JWT token
        async function fetchUserDetails() {
            const accessToken = localStorage.getItem('access');

            if (!accessToken) {
                document.getElementById('auth-status').innerText = 'Is user authenticated: False';
                document.getElementById('username').innerText = 'Username: Not logged in';
                return;
            }

            try {
                const response = await fetch('/api/user-details/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('auth-status').innerText = `Is user authenticated: True`;
                    document.getElementById('username').innerText = `Username: ${data.username}`;
                } else {
                    document.getElementById('auth-status').innerText = 'Is user authenticated: False';
                    document.getElementById('username').innerText = 'Username: Not logged in';
                }
            } catch (error) {
                document.getElementById('auth-status').innerText = 'Is user authenticated: False';
                document.getElementById('username').innerText = 'Username: Not logged in';
            }
        }

        // Call the function when the page loads
        fetchUserDetails();
    </script>
{% endblock %}